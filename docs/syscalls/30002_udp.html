<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>UDP - Tockドキュメント</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../Overview.html"><strong aria-hidden="true">1.</strong> Tockの概要</a></li><li class="chapter-item expanded "><a href="../Design.html"><strong aria-hidden="true">2.</strong> Tockの設計</a></li><li class="chapter-item expanded "><a href="../threat_model/index.html"><strong aria-hidden="true">3.</strong> Threat Model</a></li><li class="chapter-item expanded affix "><li class="part-title">Tockの実装</li><li class="chapter-item expanded "><a href="../Lifetimes.html"><strong aria-hidden="true">4.</strong> ライフタイム</a></li><li class="chapter-item expanded "><a href="../Mutable_References.html"><strong aria-hidden="true">5.</strong> 可変参照</a></li><li class="chapter-item expanded "><a href="../Soundness.html"><strong aria-hidden="true">6.</strong> 安全性</a></li><li class="chapter-item expanded "><a href="../Compilation.html"><strong aria-hidden="true">7.</strong> コンパイル</a></li><li class="chapter-item expanded "><a href="../TockBinaryFormat.html"><strong aria-hidden="true">8.</strong> TBF: Tockバイナリフォーマット</a></li><li class="chapter-item expanded "><a href="../Memory_Layout.html"><strong aria-hidden="true">9.</strong> メモリレイアウト</a></li><li class="chapter-item expanded "><a href="../Memory_Isolation.html"><strong aria-hidden="true">10.</strong> メモリ隔離</a></li><li class="chapter-item expanded "><a href="../Registers.html"><strong aria-hidden="true">11.</strong> レジスタ</a></li><li class="chapter-item expanded "><a href="../Startup.html"><strong aria-hidden="true">12.</strong> 起動</a></li><li class="chapter-item expanded "><a href="../Syscalls.html"><strong aria-hidden="true">13.</strong> システムコール</a></li><li class="chapter-item expanded "><a href="../Userland.html"><strong aria-hidden="true">14.</strong> ユーザランド</a></li><li class="chapter-item expanded "><a href="../Networking_Stack.html"><strong aria-hidden="true">15.</strong> Networking Stack</a></li><li class="chapter-item expanded "><a href="../Configuration.html"><strong aria-hidden="true">16.</strong> 構成</a></li><li class="chapter-item expanded affix "><li class="part-title">インターフェースの詳細</li><li class="chapter-item expanded "><a href="../syscalls/index.html"><strong aria-hidden="true">17.</strong> システムコールインターフェース</a></li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">17.1.</strong> コアカーネル提供</li><li><ol class="section"><li class="chapter-item expanded "><a href="../syscalls/memop.html"><strong aria-hidden="true">17.1.1.</strong> memop</a></li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">17.2.</strong> カプセル提供</li><li><ol class="section"><li class="chapter-item expanded "><a href="../syscalls/00000_alarm.html"><strong aria-hidden="true">17.2.1.</strong> Alarm</a></li><li class="chapter-item expanded "><a href="../syscalls/00001_console.html"><strong aria-hidden="true">17.2.2.</strong> Console</a></li><li class="chapter-item expanded "><a href="../syscalls/00002_leds.html"><strong aria-hidden="true">17.2.3.</strong> LED</a></li><li class="chapter-item expanded "><a href="../syscalls/00003_buttons.html"><strong aria-hidden="true">17.2.4.</strong> Button</a></li><li class="chapter-item expanded "><a href="../syscalls/00004_gpio.html"><strong aria-hidden="true">17.2.5.</strong> GPIO</a></li><li class="chapter-item expanded "><a href="../syscalls/00005_adc.html"><strong aria-hidden="true">17.2.6.</strong> ADC</a></li><li class="chapter-item expanded "><a href="../syscalls/00007_analog_comparator.html"><strong aria-hidden="true">17.2.7.</strong> AnalogComparator</a></li><li class="chapter-item expanded "><a href="../syscalls/00008_low_level_debug.html"><strong aria-hidden="true">17.2.8.</strong> Low-Level Debug</a></li><li class="chapter-item expanded "><a href="../syscalls/30002_udp.html" class="active"><strong aria-hidden="true">17.2.9.</strong> UDP</a></li><li class="chapter-item expanded "><a href="../syscalls/60000_ambient_temperature.html"><strong aria-hidden="true">17.2.10.</strong> Ambient Temp</a></li><li class="chapter-item expanded "><a href="../syscalls/60001_humidity.html"><strong aria-hidden="true">17.2.11.</strong> Humidity</a></li><li class="chapter-item expanded "><a href="../syscalls/60002_luminance.html"><strong aria-hidden="true">17.2.12.</strong> Luminance</a></li><li class="chapter-item expanded "><a href="../syscalls/70005_l3gd20.html"><strong aria-hidden="true">17.2.13.</strong> L3GD20</a></li><li class="chapter-item expanded "><a href="../syscalls/70006_lsm303dlhc.html"><strong aria-hidden="true">17.2.14.</strong> LSM303DLHC</a></li><li class="chapter-item expanded "><a href="../syscalls/80005_hd44780.html"><strong aria-hidden="true">17.2.15.</strong> HD44780</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">18.</strong> Internal Kernel Interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/trd1-trds.html"><strong aria-hidden="true">18.1.</strong> TRD 1: Tock Reference</a></li><li class="chapter-item expanded "><a href="../reference/trd102-adc.html"><strong aria-hidden="true">18.2.</strong> TRD 102: ADC</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tockのセットアップと使用法</li><li class="chapter-item expanded "><a href="../Getting_Started.html"><strong aria-hidden="true">19.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../Porting.html"><strong aria-hidden="true">20.</strong> Tockのポーティング</a></li><li class="chapter-item expanded "><a href="../OutOfTree.html"><strong aria-hidden="true">21.</strong> ツリー外のボード</a></li><li class="chapter-item expanded "><a href="../debugging/index.html"><strong aria-hidden="true">22.</strong> Debugging Help</a></li><li class="chapter-item expanded "><a href="../Style.html"><strong aria-hidden="true">23.</strong> Style</a></li><li class="chapter-item expanded affix "><li class="part-title">Management of Tock</li><li class="chapter-item expanded "><a href="../wg/index.html"><strong aria-hidden="true">24.</strong> Working Groups</a></li><li class="chapter-item expanded "><a href="../CodeReview.html"><strong aria-hidden="true">25.</strong> Code Review Process</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Tockドキュメント</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2><a class="header" href="#driver-number-0x30002" id="driver-number-0x30002">driver number: 0x30002</a></h2>
<h1><a class="header" href="#udp" id="udp">UDP</a></h1>
<h2><a class="header" href="#overview" id="overview">Overview</a></h2>
<p>The UDP driver allows a process to send and receive UDP packets using the
Tock networking stack. Currently, this driver allows for tx and rx of
UDP packets via 6LoWPAN, which sits on top of the 802.15.4 radio.</p>
<p>This driver can be found in capsules/src/net/udp/driver.rs
driver.rs implements an interface for sending
and receiving UDP messages. It also exposes a list of interace addresses to
the application layer. The primary functionality embedded in the UDP driver
is within the allow(), subscribe(), and command() calls which can be made to
the driver.</p>
<h2><a class="header" href="#allow" id="allow">Allow</a></h2>
<ul>
<li>
<p>Description allow() is used to setup buffers to read/write from. This function takes in
an <code>allow_num</code> and a slice. These allow_nums determine which buffer is being
setup as follows:</p>
</li>
<li>
<h3><a class="header" href="#allow-number-0" id="allow-number-0">Allow Number: 0</a></h3>
<p><strong>Description</strong>: Read Buffer.</p>
<p><strong>Argument 1</strong>: Slice into which the received payload should be stored</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
<li>
<h3><a class="header" href="#allow-number-1" id="allow-number-1">Allow Number: 1</a></h3>
<p><strong>Description</strong>: Write Buffer.</p>
<p><strong>Argument 1</strong>: Slice containing the UDP payload to be transmitted</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
<li>
<h3><a class="header" href="#allow-number-2" id="allow-number-2">Allow Number: 2</a></h3>
<p><strong>Description</strong>: Tx Config Buffer.</p>
<p><strong>Argument 1</strong>: Slice containing config information, namely source/destination
addresses and ports.
Specifically, the config buffer should be the size of two sock_addr_t
structs. The first half of the buffer should contain the
source address/port (represented as a sock_addr_t)
from which the application expects to send.
The second half of the buffer should contain the destination
address/port which the application wishes to send the next packet to.</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
<li>
<h3><a class="header" href="#allow-number-3" id="allow-number-3">Allow Number: 3</a></h3>
<p><strong>Description</strong>: RX Config Buffer.</p>
<p><strong>Argument 1</strong>: Slice containing the Rx config buffer.
Used to contain source/destination addresses
and ports for receives (separate from <code>2</code> because receives may
be waiting for an incoming packet asynchronously). Specifically,
the rx config buffer should be the size of two sock_addr_t
structs. The first half of the buffer should contain the
address/port (represented as a sock_addr_t)
on which the application is listening.
The second half of the buffer should contain the incoming source
address/port which the application wishes to listen for.</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
</ul>
<h2><a class="header" href="#subscribe" id="subscribe">Subscribe</a></h2>
<ul>
<li>
<p>Description: subscribe() is used to setup callbacks for when frames are transmitted or received.
It takes in a callback and a subscribe number. The subscribe number indicates the
callback type:</p>
</li>
<li>
<h3><a class="header" href="#subscribe-number-0" id="subscribe-number-0">Subscribe Number: 0</a></h3>
<p><strong>Description</strong>: Setup callback for when frame is received. This callback cannot be set unless
the app is bound to a local UDP endpoint.</p>
<p><strong>Argument 1</strong>: The callback</p>
<p><strong>Argument 2</strong>: AppId</p>
<p><strong>Returns</strong>: ERESERVE if the app is not currently bound to a port, SUCCESS otherwise.</p>
</li>
<li>
<h3><a class="header" href="#subscribe-number-1" id="subscribe-number-1">Subscribe Number: 1</a></h3>
<p><strong>Description</strong>: Setup callback for when frame is transmitted.</p>
<p><strong>Argument 1</strong>: The callback</p>
<p><strong>Argument 2</strong>: AppId</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
</ul>
<h2><a class="header" href="#command" id="command">Command</a></h2>
<ul>
<li>
<p>Description: command() is used to get the interface list or to transmit a payload. The action
taken by the driver is determined by the passed command_num:</p>
</li>
<li>
<h3><a class="header" href="#command-number-0" id="command-number-0">Command Number: 0</a></h3>
<p><strong>Description</strong>: Driver check.</p>
<p><strong>Argument 1</strong>: Unused</p>
<p><strong>Argument 2</strong>: Unused</p>
<p><strong>Argument 3</strong>: Unused</p>
<p><strong>Returns</strong>: SUCCESS</p>
</li>
<li>
<h3><a class="header" href="#command-number-1" id="command-number-1">Command Number: 1</a></h3>
<p><strong>Description</strong>: Get the interface list</p>
<p><strong>Argument 1</strong>: Number of requested interface addresses</p>
<p><strong>Argument 2</strong>: Unused</p>
<p><strong>Argument 3</strong>: AppId</p>
<p><strong>Returns</strong>: SuccessWithValue, where value is the total number of interfaces</p>
</li>
<li>
<h3><a class="header" href="#command-number-2" id="command-number-2">Command Number: 2</a></h3>
<p><strong>Description</strong>: Transmit Payload</p>
<p><strong>Argument 1</strong>: Unused</p>
<p><strong>Argument 2</strong>: Unused</p>
<p><strong>Argument 3</strong>: AppId</p>
<p><strong>Returns</strong>: EBUSY is this process already has a pending tx.
Returns EINVAL if no valid buffer has been loaded into the write buffer,
or if the config buffer is the wrong length, or if the destination and source
port/address pairs cannot be parsed.
Otherwise, returns the result of do_next_tx_immediate(). Notably, a successful
transmit can produce two different success values. If success is returned,
this simply means that the packet was queued. In this case, the app still
still needs to wait for a callback to check if any errors occurred before
the packet was passed to the radio. However, if SuccessWithValue
is returned with value 1, this means the the packet was successfully passed
the radio without any errors, which tells the userland application that it does
not need to wait for a callback to check if any errors occured while the packet
was being passed down to the radio. Any successful return value indicates that
the app should wait for a send_done() callback before attempting to queue another
packet.
Currently, only will transmit if the app has bound to the port passed in the tx_cfg
buf as the source address. If no port is bound, returns ERESERVE, if it tries to
send on a port other than the port which is bound, returns EINVALID.</p>
<pre><code>         Notably, the currently transmit implementation allows for starvation - an
         an app with a lower app id can send constantly and starve an app with a
         later ID.
</code></pre>
</li>
<li>
<h3><a class="header" href="#command-number-3" id="command-number-3">Command Number: 3</a></h3>
<p><strong>Description</strong>: Bind to the address and port in rx_cfg.
This command should be called after allow() is called on the rx_cfg buffer, and
after subscribe() is used to set up the recv callback. If this command is called
and the address in rx_cfg is 0::0 : 0, this command will reset the option
containing the bound port to None, and set the rx callback to None.</p>
<p><strong>Argument 1</strong>: Unused</p>
<p><strong>Argument 2</strong>: Unused</p>
<p><strong>Argument 3</strong>: AppId</p>
<p><strong>Returns</strong>: Returns SUCCESS if that addr/port combo is free,
returns EINVAL if the address requested is not a local interface, or if the port
requested is 0. Returns EBUSY if that port is already bound to by another app.</p>
</li>
<li>
<h3><a class="header" href="#command-number-4" id="command-number-4">Command Number: 4</a></h3>
<p><strong>Description</strong>: Returns the maximum payload that can be transmitted by apps using this driver.
This represents the size of the payload buffer in the kernel. Apps can use
this syscall to ensure they do not attempt to send too-large messages.</p>
<p><strong>Argument 1</strong>: Unused</p>
<p><strong>Argument 2</strong>: Unused</p>
<p><strong>Argument 3</strong>: AppId</p>
<p><strong>Returns</strong>: Returns SUCCESSWithValue, where the value is the maximum tx payload length</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../syscalls/00008_low_level_debug.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../syscalls/60000_ambient_temperature.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../syscalls/00008_low_level_debug.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../syscalls/60000_ambient_temperature.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
