<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ADC - Tockドキュメント</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../Overview.html"><strong aria-hidden="true">1.</strong> Tockの概要</a></li><li class="chapter-item expanded "><a href="../Design.html"><strong aria-hidden="true">2.</strong> Tockの設計</a></li><li class="chapter-item expanded "><a href="../threat_model/index.html"><strong aria-hidden="true">3.</strong> Threat Model</a></li><li class="chapter-item expanded affix "><li class="part-title">Tockの実装</li><li class="chapter-item expanded "><a href="../Lifetimes.html"><strong aria-hidden="true">4.</strong> ライフタイム</a></li><li class="chapter-item expanded "><a href="../Mutable_References.html"><strong aria-hidden="true">5.</strong> 可変参照</a></li><li class="chapter-item expanded "><a href="../Soundness.html"><strong aria-hidden="true">6.</strong> 安全性</a></li><li class="chapter-item expanded "><a href="../Compilation.html"><strong aria-hidden="true">7.</strong> コンパイル</a></li><li class="chapter-item expanded "><a href="../TockBinaryFormat.html"><strong aria-hidden="true">8.</strong> TBF: Tockバイナリフォーマット</a></li><li class="chapter-item expanded "><a href="../Memory_Layout.html"><strong aria-hidden="true">9.</strong> メモリレイアウト</a></li><li class="chapter-item expanded "><a href="../Memory_Isolation.html"><strong aria-hidden="true">10.</strong> メモリ隔離</a></li><li class="chapter-item expanded "><a href="../Registers.html"><strong aria-hidden="true">11.</strong> レジスタ</a></li><li class="chapter-item expanded "><a href="../Startup.html"><strong aria-hidden="true">12.</strong> 起動</a></li><li class="chapter-item expanded "><a href="../Syscalls.html"><strong aria-hidden="true">13.</strong> システムコール</a></li><li class="chapter-item expanded "><a href="../Userland.html"><strong aria-hidden="true">14.</strong> ユーザランド</a></li><li class="chapter-item expanded "><a href="../Networking_Stack.html"><strong aria-hidden="true">15.</strong> Networking Stack</a></li><li class="chapter-item expanded "><a href="../Configuration.html"><strong aria-hidden="true">16.</strong> 構成</a></li><li class="chapter-item expanded affix "><li class="part-title">インターフェースの詳細</li><li class="chapter-item expanded "><a href="../syscalls/index.html"><strong aria-hidden="true">17.</strong> システムコールインターフェース</a></li><li><ol class="section"><li class="chapter-item expanded "><strong aria-hidden="true">17.1.</strong> コアカーネル提供</li><li><ol class="section"><li class="chapter-item expanded "><a href="../syscalls/memop.html"><strong aria-hidden="true">17.1.1.</strong> memop</a></li></ol></li><li class="chapter-item expanded "><strong aria-hidden="true">17.2.</strong> カプセル提供</li><li><ol class="section"><li class="chapter-item expanded "><a href="../syscalls/00000_alarm.html"><strong aria-hidden="true">17.2.1.</strong> Alarm</a></li><li class="chapter-item expanded "><a href="../syscalls/00001_console.html"><strong aria-hidden="true">17.2.2.</strong> Console</a></li><li class="chapter-item expanded "><a href="../syscalls/00002_leds.html"><strong aria-hidden="true">17.2.3.</strong> LED</a></li><li class="chapter-item expanded "><a href="../syscalls/00003_buttons.html"><strong aria-hidden="true">17.2.4.</strong> Button</a></li><li class="chapter-item expanded "><a href="../syscalls/00004_gpio.html"><strong aria-hidden="true">17.2.5.</strong> GPIO</a></li><li class="chapter-item expanded "><a href="../syscalls/00005_adc.html" class="active"><strong aria-hidden="true">17.2.6.</strong> ADC</a></li><li class="chapter-item expanded "><a href="../syscalls/00007_analog_comparator.html"><strong aria-hidden="true">17.2.7.</strong> AnalogComparator</a></li><li class="chapter-item expanded "><a href="../syscalls/00008_low_level_debug.html"><strong aria-hidden="true">17.2.8.</strong> Low-Level Debug</a></li><li class="chapter-item expanded "><a href="../syscalls/30002_udp.html"><strong aria-hidden="true">17.2.9.</strong> UDP</a></li><li class="chapter-item expanded "><a href="../syscalls/60000_ambient_temperature.html"><strong aria-hidden="true">17.2.10.</strong> Ambient Temp</a></li><li class="chapter-item expanded "><a href="../syscalls/60001_humidity.html"><strong aria-hidden="true">17.2.11.</strong> Humidity</a></li><li class="chapter-item expanded "><a href="../syscalls/60002_luminance.html"><strong aria-hidden="true">17.2.12.</strong> Luminance</a></li><li class="chapter-item expanded "><a href="../syscalls/70005_l3gd20.html"><strong aria-hidden="true">17.2.13.</strong> L3GD20</a></li><li class="chapter-item expanded "><a href="../syscalls/70006_lsm303dlhc.html"><strong aria-hidden="true">17.2.14.</strong> LSM303DLHC</a></li><li class="chapter-item expanded "><a href="../syscalls/80005_hd44780.html"><strong aria-hidden="true">17.2.15.</strong> HD44780</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../reference/index.html"><strong aria-hidden="true">18.</strong> Internal Kernel Interfaces</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/trd1-trds.html"><strong aria-hidden="true">18.1.</strong> TRD 1: Tock Reference</a></li><li class="chapter-item expanded "><a href="../reference/trd102-adc.html"><strong aria-hidden="true">18.2.</strong> TRD 102: ADC</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Tockのセットアップと使用法</li><li class="chapter-item expanded "><a href="../Getting_Started.html"><strong aria-hidden="true">19.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../Porting.html"><strong aria-hidden="true">20.</strong> Tockのポーティング</a></li><li class="chapter-item expanded "><a href="../OutOfTree.html"><strong aria-hidden="true">21.</strong> ツリー外のボード</a></li><li class="chapter-item expanded "><a href="../debugging/index.html"><strong aria-hidden="true">22.</strong> Debugging Help</a></li><li class="chapter-item expanded "><a href="../Style.html"><strong aria-hidden="true">23.</strong> Style</a></li><li class="chapter-item expanded affix "><li class="part-title">Management of Tock</li><li class="chapter-item expanded "><a href="../wg/index.html"><strong aria-hidden="true">24.</strong> Working Groups</a></li><li class="chapter-item expanded "><a href="../CodeReview.html"><strong aria-hidden="true">25.</strong> Code Review Process</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Tockドキュメント</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2><a class="header" href="#driver-number-0x00005" id="driver-number-0x00005">driver number: 0x00005</a></h2>
<h1><a class="header" href="#adc-analog-to-digital-converter" id="adc-analog-to-digital-converter">ADC (Analog-to-Digital Converter)</a></h1>
<h2><a class="header" href="#overview" id="overview">Overview</a></h2>
<p>The ADC driver allows userspace to measure analog signals. The signals, such as
a sensor measurement or voltage level, are usually connected to external pins
on the microcontroller, referred to as channels, and this driver supports
selecting which channel to measure from. Channels available to userspace are
selected by the board configuration, and are indexed starting from zero.
The number of bits of data in each sample and the possible voltage range of
each sample are chip specific.</p>
<p>The ADC driver is capable of requesting single samples, single samples repeated
at a specified frequency, a buffer full of samples at a specified frequency,
and continuously sampling at a specified frequency. The minimum and maximum
sampling frequencies are chip specific.</p>
<h2><a class="header" href="#command" id="command">Command</a></h2>
<ul>
<li>
<h3><a class="header" href="#command-number-0" id="command-number-0">Command number: <code>0</code></a></h3>
<p><strong>Description</strong>: How many ADC channels are supported on this board.</p>
<p><strong>Argument 1</strong>: Unused.</p>
<p><strong>Argument 2</strong>: unused</p>
<p><strong>Returns</strong>: The number of channels on the board, or <code>ENODEVICE</code> if this
driver is not present on the board.</p>
</li>
<li>
<h3><a class="header" href="#command-number-1" id="command-number-1">Command number: <code>1</code></a></h3>
<p><strong>Description</strong>: Measure the analog value of a single channel once. The
callback will return the sample. This command will succeed even if a
callback is not registered yet.</p>
<p><strong>Argument 1</strong>: The index of the channel to sample, starting at 0.</p>
<p><strong>Argument 2</strong>: unused</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> if the command was successful, <code>EBUSY</code> if the ADC is
already sampling a channel, and <code>EINVAL</code> if the channel index is invalid.
<code>FAIL</code> may also be returned if the hardware has a fault.</p>
</li>
<li>
<h3><a class="header" href="#command-number-2" id="command-number-2">Command number: <code>2</code></a></h3>
<p><strong>Description</strong>: Measure the analog value of a single channel repeatedly.
The callback will return each sample value individually. This command will
succeed even if a callback is not registered yet.</p>
<p><strong>Argument 1</strong>: The index of the channel to sample, starting at 0.</p>
<p><strong>Argument 2</strong>: The frequency at which to sample the value.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> if the command was successful, <code>EBUSY</code> if the ADC is
already sampling a channel, and <code>EINVAL</code> if the channel index is invalid or
the frequency is outside of the acceptable range. <code>FAIL</code> may also be
returned if the hardware has a fault.</p>
</li>
<li>
<h3><a class="header" href="#command-number-3" id="command-number-3">Command number: <code>3</code></a></h3>
<p><strong>Description</strong>: Measure the analog value of a single channel repeatedly,
filling a buffer with data before sending a callback. The callback will
return the buffer of samples. This command will succeed even if a callback
is not registered yet. A buffer must have previously been provided through
an <code>allow</code> call before this command will succeed.</p>
<p><strong>Argument 1</strong>: The index of the channel to sample, starting at 0.</p>
<p><strong>Argument 2</strong>: The frequency at which to sample the value.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> if the command was successful, <code>EBUSY</code> if the ADC is
already sampling a channel, <code>ENOMEM</code> if a buffer has not been provided, and
<code>EINVAL</code> if the channel index is invalid or the frequency is outside of the
acceptable range. <code>FAIL</code> may also be returned if the hardware has a fault.</p>
</li>
<li>
<h3><a class="header" href="#command-number-4" id="command-number-4">Command number: <code>4</code></a></h3>
<p><strong>Description</strong>: Measure the analog value of a single channel continuously.
Two buffers must be provided by <code>allow</code> calls before this command will
succeed. The buffers will be filled with samples in an alternating fashion,
with the callback returning the buffer full of samples. Special care must
be taken when using this command to ensure that the buffer sizes are large
enough for the specified sampling frequency that all samples can be read
before the next buffer is filled with samples. This command will succeed
even if a callback is not registered yet.</p>
<p><strong>Argument 1</strong>: The index of the channel to sample, starting at 0.</p>
<p><strong>Argument 2</strong>: The frequency at which to sample the value.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> if the command was successful, <code>EBUSY</code> if the ADC is
already sampling a channel, <code>ENOMEM</code> if both buffers have not been
provided, and <code>EINVAL</code> if the channel index is invalid or the frequency is
outside of the acceptable range. <code>FAIL</code> may also be returned if the
hardware has a fault.</p>
</li>
<li>
<h3><a class="header" href="#command-number-5" id="command-number-5">Command number: <code>5</code></a></h3>
<p><strong>Description</strong>: Stop any active sampling operation. This command is
successful even if no sampling operation was in progress.</p>
<p><strong>Argument 1</strong>: Unused.</p>
<p><strong>Argument 2</strong>: unused</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> in all cases.</p>
</li>
</ul>
<h2><a class="header" href="#subscribe" id="subscribe">Subscribe</a></h2>
<ul>
<li>
<h3><a class="header" href="#subscribe-number-0" id="subscribe-number-0">Subscribe number: <code>0</code></a></h3>
<p><strong>Description</strong>: Register a callback that will fire when requested samples
are ready, replacing any previously registered callback. The samples
collected before a callback is fired depends on the command which began the
sampling operation. Registering the callback does not start or stop any
sampling operations.</p>
<p><strong>Callback signature</strong>: The signature of the callback depends on the
command used to begin sampling operations. In all cases, the first argument
is the type of ADC sampling operation that triggered this callback. If the
operation provides individual samples (singly or repeatedly), the second
argument will be the channel on which sampling occurred and the third
argument will be the sample value. If the operation provides buffered
samples (singly or repeatedly), the second argument will contain the
channel index in the least significant 8 bits and the length of the buffer
in the most significant 24 bits, while the third argument will be a pointer
to the buffer filled with samples.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> in all cases.</p>
</li>
</ul>
<h2><a class="header" href="#allow" id="allow">Allow</a></h2>
<ul>
<li>
<h3><a class="header" href="#allow-number-0" id="allow-number-0">Allow number: <code>0</code></a></h3>
<p><strong>Description</strong>: Provide a buffer into which samples values can be placed,
replacing any previously provided buffer. This buffer will be used for any
singly collected buffered data and will be used in addition to the second
buffer for repeated buffered sampling. Future ADC operations will continue
to use the same buffer.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> in all cases.</p>
</li>
<li>
<h3><a class="header" href="#allow-number-1" id="allow-number-1">Allow number: <code>1</code></a></h3>
<p><strong>Description</strong>: Provide a buffer into which samples values can be placed
when repeatedly buffered sampling, replacing any previously provided buffer.
This buffer and the other provided buffer will be alternated between. Future
ADC operations will continue to use the same buffer.</p>
<p><strong>Returns</strong>: <code>SUCCESS</code> in all cases.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../syscalls/00004_gpio.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../syscalls/00007_analog_comparator.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../syscalls/00004_gpio.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../syscalls/00007_analog_comparator.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
